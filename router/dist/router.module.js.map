{"version":3,"file":"router.module.js","sources":["../src/index.js"],"sourcesContent":["/**\n * Helper to trim start/end slash\n * @param {String} path \n */\nconst clearSlashes = path =>\n  path\n    .replace(/\\/$/, '')\n    .replace(/^\\//, '')\n\n/**\n * Helper to get pathname from url\n */\nconst getFragment = () => {\n  let fragment = '';\n  const match = window.location.href.match(/#!(.*)$/)\n  fragment = match ? match[1] : ''\n  return clearSlashes(fragment)\n}\n\nclass Router {\n  \n  __routes = []\n  __preloader = null\n  __parentNode = null\n  __render = null\n  \n  /**\n   * Router instance\n   * @param {{ mount, render, preloader? }} config - Configuration\n   */\n  constructor (config) {\n    if (!config.mount) throw Error('[Router] \"mount\" point is missing')\n    if (!config.render) throw Error('[Router] \"render\" func is missing')\n    this.__parentNode = document.querySelector(config.mount)\n    this.__render = config.render\n    if (config.preloader) this.__preloader = config.preloader\n    window.addEventListener('popstate', () => this.listen());\n  }\n\n  /**\n   * Add route\n   * @param {String} path - URL Path\n   * @param {{ view: Function, state?: Object }} component - Routed component\n   */\n  add = (path, component) => {\n    path = path === '/' ? '^\\/?$' : new RegExp(clearSlashes(path) + '$')\n    this.__routes.push({ path, component })    \n  }\n\n  /**\n   * Render router component\n   * @param {{ view: Function, state?: Object }} component - Routed component\n   * @param {Array} params - URL Params\n   */\n  __mount = (component, params) => {\n    // Extract from routed component\n    const app = component(params)\n    const { view, state } = app\n    \n    // Dynamic / async componoent\n    if (typeof app.then === 'function') {\n      \n      // Render preloader if exists\n      if (this.__preloader) {\n        this.__render(this.__parentNode, this.__preloader)\n      }\n\n      app.then(resp => {\n        const { view, state } = resp.default()\n        this.__render(this.__parentNode, view, state)\n      })\n\n    } else {\n\n      this.__render(this.__parentNode, view, state)\n\n    }\n  }\n\n  /**\n   * Handle mount on route changes\n   */\n  listen = () => {\n    const current = getFragment()\n    this.__routes.some(({ path, component }) => {\n      const match = current.match(path)\n      if (match) {\n        match.shift()\n        this.__mount(component, match)\n        return match;\n      }\n      return false\n    })\n  }\n}\n\nexport default Router\n"],"names":["clearSlashes","path","replace","config","__routes","__preloader","__parentNode","__render","add","component","RegExp","_this","push","__mount","params","app","view","state","then","resp","listen","match","current","window","location","href","some","shift","mount","Error","render","this","document","querySelector","preloader","addEventListener"],"mappings":"AAIA,IAAMA,EAAe,SAAAC,UACnBA,EACGC,QAAQ,MAAO,IACfA,QAAQ,MAAO,oBAuBlB,SAAaC,cACX,QAVFC,EAAW,QACXC,EAAc,UACdC,EAAe,UACfC,EAAW,UAoBXC,IAAM,SAACP,EAAMQ,GACXR,EAAgB,MAATA,EAAe,OAAU,IAAIS,OAAOV,EAAaC,GAAQ,KAChEU,EAAKP,EAASQ,KAAK,CAAEX,KAAAA,EAAMQ,UAAAA,UAQ7BI,EAAU,SAACJ,EAAWK,GAEpB,IAAMC,EAAMN,EAAUK,GACdE,EAAgBD,EAAhBC,KAAMC,EAAUF,EAAVE,MAGU,mBAAbF,EAAIG,MAGTP,EAAKN,GACPM,EAAKJ,EAASI,EAAKL,EAAcK,EAAKN,GAGxCU,EAAIG,KAAK,SAAAC,SACiBA,YACxBR,EAAKJ,EAASI,EAAKL,IADXU,OAAMC,UAMhBN,EAAKJ,EAASI,EAAKL,EAAcU,EAAMC,SAQ3CG,OAAS,WACP,IArEIC,EAqEEC,GArEFD,EAAQE,OAAOC,SAASC,KAAKJ,MAAM,WAElCrB,EADIqB,EAAQA,EAAM,GAAK,KAqE5BV,EAAKP,EAASsB,KAAK,gBAASjB,IAAAA,UACpBY,EAAQC,EAAQD,QADFpB,MAEpB,QAAIoB,IACFA,EAAMM,QACNhB,EAAKE,EAAQJ,EAAWY,GACjBA,OA1DNlB,EAAOyB,MAAO,MAAMC,MAAM,qCAC/B,IAAK1B,EAAO2B,OAAQ,MAAMD,MAAM,qCAChCE,KAAKzB,EAAe0B,SAASC,cAAc9B,EAAOyB,OAClDG,KAAKxB,EAAWJ,EAAO2B,OACnB3B,EAAO+B,YAAWH,KAAK1B,EAAcF,EAAO+B,WAChDX,OAAOY,iBAAiB,WAAY,kBAAMxB,EAAKS"}